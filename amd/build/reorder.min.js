define(["jquery"],function(a){"use strict";function b(b){var e=a(b.currentTarget),f=parseInt(e.data("lastPosition"),10),g=parseInt(e.val(),10);if(f!==g){var i=null,j=a(h.MOVETO);if(j.each(function(){var b=a(this);if(b.attr("id")!==e.attr("id")&&parseInt(b.val(),10)===g)return i=b.closest(h.FIELDWRAPPER),!1}),i){c();var k=e.closest(h.FIELDWRAPPER);g<f?k.insertBefore(i):k.insertAfter(i),j=a(h.MOVETO),j.each(function(b){var c=a(this),d=b+1;c.data("lastPosition",d),c.val(d),c.closest(h.FIELDWRAPPER).find(h.RULENUMBER).html(d)}),k.removeClass("localprofile-flash").addClass("localprofile-flash"),d()}}}function c(){var b=a("#region-main form");b.find(h.FIELDWRAPPER).removeClass("localprofile-flash").each(function(){var b=a(this);b.closest(".localprofile-combined").length&&b.unwrap()})}function d(){var b=null,c=a("#region-main form");c.find(h.FIELDWRAPPER).each(function(){var c=a(this),d=c.find("input.andnextrule");d.length&&(d.prop("checked")?b=b?b.add(c):c:b&&(b=b.add(c),b.wrapAll('<div class="localprofile-combined" />'),b=null))}),b&&(b.wrapAll('<div class="localprofile-combined" />'),b=null),e()}function e(){var b=a("#region-main form input.andnextrule");b.closest("label").length?b.closest("label").removeClass("hidden").last().addClass("hidden"):b.closest("span").removeClass("hidden").last().addClass("hidden")}function f(){c(),d()}function g(){var b=a("#region-main form input.deleterule");b.each(function(){var b=a(this),c=b.closest(".localprofile-fieldwrapper");b.prop("checked")?(c.addClass("todelete"),c.find(":input:not(.deleterule)").prop("disabled",!0)):(c.removeClass("todelete"),c.find(":input").prop("disabled",!1))})}var h={MOVETO:"select.moveto, .moveto select",FIELDWRAPPER:".localprofile-fieldwrapper",RULENUMBER:".localprofile-number"};return{init:function(){var c=a("#region-main form");c.find(h.MOVETO).each(function(){var b=a(this);b.data("lastPosition",b.val())}),c.on("change",h.MOVETO,b),c.on("change","input.andnextrule",f),c.on("change","input.deleterule",g),d()}}});